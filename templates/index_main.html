<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../static/main.css">
    <link rel="stylesheet" href="http://cdn.jsdelivr.net/npm/xeicon@2.3.3/xeicon.min.css">
    <!-- <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="crossorigin">
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&display=swap" rel="stylesheet"> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <title>미슐랭4스타</title>
</head>

<body>
    <div id="sketch">
        <section class="banner">
            <a href="/"><img class="logo" src="https://i.ibb.co/0V4mdTc/M4S-Logo.png" alt="M4S-Logo"></a>
            <div class="logIn_section">
                <span id="signIn">로그인</span>
                <span>|</span>
                <span id="signUp">회원가입</span>
            </div>
        </section>
        <section class="mainCont">
            <section class="slide">
                <ul class="slideul">
                    <li class="slide1"></li>
                    <li class="slide2"></li>
                    <li class="slide3"></li>
                </ul>
                <p id="left" class="xi-angle-left"></p>
                <p id="right" class="xi-angle-right"></p>
            </section>
            <section class="middle">
                <div class="middle2">
                    <div class="sub_title">
                        <p>추천 맛집</p>
                        <button class="add">추가하기</button>
                    </div>
                    <span class="part"></span>
                    <div class="list_box">
                        <ul class="list1" id="list_box1">
                        </ul>
                    </div>
                </div>
                <p class="xi-angle-left left1"></p>
                <p class="xi-angle-right right1"></p>
            </section>
            <section class="bottom">
                <button class="more">펼쳐 보기</button>
            </section>

            <section class="add_middle">
                <div class="add_middle2">
                    <div class="add_sub_title">
                        <p>추천 맛집</p>
                        <button class="add2">추가하기</button>
                    </div>
                    <span class="part"></span>
                    <div class="list_box">
                        <ul class="list1" id="list_box1">
                        </ul>
                    </div>
                </div>
            </section>
        </section>
    </div>

    <div id="logBox">
        <section class="top">
            <p>로그인</p>
        </section>
        <section class="idpas">
            <input type="id" placeholder="id" class="iid">
            <input type="password" placeholder="password" class="ipw">
        </section>
        <section class="btnar">
            <button class="logBtn">로그인</button>
        </section>
        <section class="findInfo">
            <a href="#">아이디 찾기</a>
            <a href="#">비밀번호 찾기</a>
            <a href="#">회원가입</a>
        </section>
        <i class="xi-close"></i>
    </div>

    <div id="signUpBox">
        <section class="top">
            <p>회원 가입</p>
        </section>
        <section class="ci">
            <input type="text" name="ci" placeholder="닉네임" class="uci" required="required">
            <label for="ci"></label>
        </section>
        <section class="id">
            <input type="text" name="id" placeholder="id 입력" class="uid" required="required">
            <label for="id"></label>
        </section>
        <section class="pw">
            <input type="password" name="pw" placeholder="password 입력" class="upw" required="required">
            <label for="pw"></label>
        </section>
        <section class="ph">
            <input type="text" name="ph" placeholder="연락처" class="uph">
            <label for="ph"></label>
        </section>
        <section class="su">
            <button class="suBtn">가입 완료</button>
        </section>
        <i class="xi-close"></i>
    </div>

    <div id="addBox">
        <section class="top">
            <p>맛집 등록</p>
        </section>
        <div class="input_area">
            <section class="addBox_imgUrl">
                <label>이미지</label>
                <input id="img" type="url" class="form-control" placeholder="이미지URL">
            </section>
            <section class="addBox_shop">
                <label>가게명</label>
                <input id="sikdang" type="text" class="form-control" placeholder="가게명" required="required">
            </section>
            <section class="addBox_menu">
                <label>추천 메뉴</label>
                <input id="bestmenu" type="text" class="form-control" placeholder="메뉴 이름">
            </section>
            <section class="addBox_location">
                <label>가게 위치</label>
                <input id="place" type="text" class="form-control" placeholder="가게 위치" required="required">
            </section>
            <section class="star_point">
                <label class="input-group-text" for="inputGroupSelect01">별점</label>
                <select class="form-select" id="star" required="required">
                    <option selected="selected">-- 선택하기 --</option>
                    <option value="1">⭐</option>
                    <option value="2">⭐⭐</option>
                    <option value="3">⭐⭐⭐</option>
                    <option value="4">⭐⭐⭐⭐</option>
                    <option value="5">⭐⭐⭐⭐⭐</option>
                </select>
            </section>
        </div>
        <button onclick="save()" class="addBtn">추가하기</button>
        <i class="xi-close"></i>
    </div>
</body>

</html>

<script>
    setInterval(function () {
        $('.slideul').animate({ marginLeft: '-1200px' }, function () {
            $('.slideul').css('margin-left', '0px');
            $('.slideul>li').eq(0).appendTo('.slideul');
        });
    }, 5000, 'linear')

    $('#left').click(function () {
        $('.slideul>li:last-child').prependTo('.slideul');
        $('.slideul').css('margin-left', '-1200px');
        $('.slideul').animate({ marginLeft: '0px' }, 200, 'linear');
    });

    $('#right').click(function () {
        $('.slideul').animate({ marginLeft: '-1200px' }, 200, 'linear', function () {
            $('.slideul').css('margin-left', '0px');
            $('.slideul>li').eq(0).appendTo('.slideul');
        });
    });

    $('#logBox').hide();

    $('#signIn').click(function () {
        $('#signUpBox').hide();
        $('#logBox').fadeIn(500);
        $('#sketch').addClass('blur');
        $('#sketch').css("pointer-events", "none");
    });

    $('#logBox>i').click(function () {
        $('#signUpBox').hide();
        $('#logBox').hide();
        $('#addBox').hide();
        $('#sketch').removeClass('blur');
        $('#sketch').css("pointer-events", "auto");
        $('.iid').val('');
        $('.ipw').val('');
    });

    $('.logBtn').click(function () {
        if ($('.iid').val() == 'michelin' && $('.ipw').val() == '4star') {
            alert('반가워요!');
            $('#signUpBox').hide();
            $('#logBox').hide();
            $('#addBox').hide();
            $('#sketch').removeClass('blur');
            $('#sketch').css("pointer-events", "auto");
            $('.iid').val('');
            $('.ipw').val('');
            $('.logIn_section').css('display', 'none');
        } else {
            alert('id또는 pw를 다시 입력해 주세요!');
        }
    })

    $('#signUpBox').hide();

    $('#signUp').click(function () {
        $('#logBox').hide();
        $('#signUpBox').fadeIn(500);
        $('#sketch').addClass('blur');
        $('#sketch').css("pointer-events", "none");
    });

    $('#signUpBox>i').click(function () {
        $('#logBox').hide();
        $('#signUpBox').hide();
        $('#addBox').hide();
        $('#sketch').removeClass('blur');
        $('#sketch').css("pointer-events", "auto");
    });

    $('.suBtn').click(function () {
        if ($('.uci').val() == '') {
            alert('닉네임은 필수 입력 사항 입니다!')
        } else if ($('.uid').val() == '') {
            alert('id는 필수 입력 사항 입니다!');
        } else if ($('.upw').val() == '') {
            alert('pw는 필수 입력 사항 입니다!');
        } else {
            alert('가입이 완료 되었습니다!');
            $('#logBox').hide();
            $('#signUpBox').hide();
            $('#addBox').hide();
            $('#sketch').removeClass('blur');
            $('#sketch').css("pointer-events", "auto");
            $('.uci').val('');
            $('.uid').val('');
            $('upw').val('');
            $('uph').val('');
        }
    });

    $('#addBox').hide();

    $('.add').click(function () {
        // let logInCss = $('.logIn_section').css('display');
        // if (logInCss == 'block') {
        //     alert('로그인후 이용해 주세요!');
        // } else {
        $('#addBox').fadeIn(500);
        $('#sketch').addClass('blur');
        $('#sketch').css("pointer-events", "none");
        // }
    });

    $('#addBox>i').click(function () {
        $('#signUpBox').hide();
        $('#logBox').hide();
        $('#addBox').hide();
        $('#sketch').removeClass('blur');
        $('#sketch').css("pointer-events", "auto");
        $('#img').val('');
        $('#sikdang').val('');
        $('#bestmenu').val('');
        $('#place').val('');
        $('#star').val('-- 선택하기 --');
    });

    function save() {
        if ($('#sikdang').val() == 0 || $('#place').val() == 0 || $('#star').val() == '-- 선택하기 --') {
            alert('가게명 & 가게 위치 & 별점을 입력해 주세요!');
        } else {
            let image = $('#img').val()
            let shop = $('#sikdang').val()
            let menu = $('#bestmenu').val()
            let place = $('#place').val()
            let star = $('#star').val()

            let formData = new FormData();
            formData.append("image_give", image);
            formData.append("shop_give", shop);
            formData.append("menu_give", menu);
            formData.append("place_give", place);
            formData.append("star_give", star);

            fetch('/save', { method: "POST", body: formData }).then((res) => res.json()).then((data) => {
                console.log(data);
                alert(data["msg"]);
            });

            $('#signUpBox').hide();
            $('#logBox').hide();
            $('#addBox').hide();
            $('#sketch').removeClass('blur');
            $('#sketch').css("pointer-events", "auto");
            $('#img').val('');
            $('#sikdang').val('');
            $('#bestmenu').val('');
            $('#place').val('');
            $('#star').val('-- 선택하기 --');
        };
    };

    $('.left1').css('display', 'none');
    $('.left2').css('display', 'none');
    $('.left3').css('display', 'none');
    $('.left4').css('display', 'none');

    let count = 0;
    $('.left1').click(function () {
        count--;
        if (count <= 0) {
            $('.left1').css('display', 'none');
            $('.list1').css('margin-left', '0px');
        } else if (count > 0) {
            $('.left1').css('display', 'block');
            let left = count * -1856;
            $('.list1').css('margin-left', left + 110 + 'px');
            if (count < 2) {
                $('.right1').css('display', 'block');
            };
        };
    });

    $('.right1').click(function () {
        let riMar = $('.list1').css('margin-left');
        count++;
        console.log(count);
        if (count > 0) {
            $('.left1').css('display', 'block');
            let right = count * -1856;
            $('.list1').css('margin-left', right + 110 + 'px');
            if (count == 2) {
                $('.list1').css('margin-left', '-2562px');
                $('.right1').css('display', 'none');
            };
        };
    });

    $('.left2').click(function () {
        count--;
        if (count <= 0) {
            $('.left2').css('display', 'none');
            $('.list2').css('margin-left', '0px');
        } else if (count > 0) {
            $('.left2').css('display', 'block');
            let left = count * -1856;
            $('.list2').css('margin-left', left + 110 + 'px');
            if (count < 7) {
                $('.right2').css('display', 'block');
            };
        };
    });

    $('.right2').click(function () {
        let riMar = $('.list2').css('margin-left');
        count++;
        console.log(count);
        if (count > 0) {
            $('.left2').css('display', 'block');
            let right = count * -1856;
            $('.list2').css('margin-left', right + 110 + 'px');
            if (count == 7) {
                $('.list2').css('margin-left', '-12310px');
                $('.right2').css('display', 'none');
            };
        };
    });

    $('.left3').click(function () {
        count--;
        if (count <= 0) {
            $('.left3').css('display', 'none');
            $('.list3').css('margin-left', '0px');
        } else if (count > 0) {
            $('.left3').css('display', 'block');
            let left = count * -1856;
            $('.list3').css('margin-left', left + 110 + 'px');
            if (count < 7) {
                $('.right3').css('display', 'block');
            };
        };
    });

    $('.right3').click(function () {
        let riMar = $('.list3').css('margin-left');
        count++;
        console.log(count);
        if (count > 0) {
            $('.left3').css('display', 'block');
            let right = count * -1856;
            $('.list3').css('margin-left', right + 110 + 'px');
            if (count == 7) {
                $('.list3').css('margin-left', '-12310px');
                $('.right3').css('display', 'none');
            };
        };
    });

    $('.left4').click(function () {
        count--;
        if (count <= 0) {
            $('.left4').css('display', 'none');
            $('.list4').css('margin-left', '0px');
        } else if (count > 0) {
            $('.left4').css('display', 'block');
            let left = count * -1856;
            $('.list4').css('margin-left', left + 110 + 'px');
            if (count < 7) {
                $('.right4').css('display', 'block');
            };
        };
    });

    $('.right4').click(function () {
        let riMar = $('.list4').css('margin-left');
        count++;
        console.log(count);
        if (count > 0) {
            $('.left4').css('display', 'block');
            let right = count * -1856;
            $('.list4').css('margin-left', right + 110 + 'px');
            if (count == 7) {
                $('.list4').css('margin-left', '-12310px');
                $('.right4').css('display', 'none');
            };
        };
    });

    $('.add_middle').hide();

    $('.more').click(function () {
        $('html').css('height', '150%');
        $('body').css('height', '150%');
        $('.add_middle').show();
        $('.more').hide();
        $('.add_middle').css('margin', '60px auto');
    });

    $(document).ready(function () {
        listing();
    });

    function listing() {
        fetch('/sik').then((res) => res.json()).then((data) => {
            let rows = data['mglist']
            console.log(rows)
            $('#list_box1, #list_box2, #list_box3, #list_box4').empty()
            rows.forEach((a) => {
                let image = a['image']
                let shop = a['shop']
                let temp_html = `<li>
                                        <a href='/detail/${shop}' class="img_box">
                                            <img src="${image}"
                                                class="card-img-top" alt="">
                                        </a>
                                        <a href="/detail/${shop}" class="text_box">
                                            <p class="res_name">${shop}</p>
                                        </a>
                                    </li>`
                $('#list_box1, #list_box2, #list_box3, #list_box4').append(temp_html)
            });
        });
    };
</script>